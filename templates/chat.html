{% extends "base.html" %}
<h2 style="text-align: center;">Talk to ZOE</h2>
<div id="chat-box">
  <div id="messages"></div>
  <input type="text" id="user-input" placeholder="Ask ZOE something..." />
  <button onclick="sendMessage()">Send</button>
</div>

<script>
  function speak(text) {
    const synth = window.speechSynthesis;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    synth.speak(utterance);
  }

  async function sendMessage() {
    const userInput = document.getElementById('user-input').value;
    if (!userInput.trim()) return;

    const msgBox = document.getElementById('messages');
    msgBox.innerHTML += `<div class="bubble user"><strong>You:</strong> ${userInput}</div>`;
    document.getElementById('user-input').value = '';

    const response = await fetch('/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: userInput })
    });

    const data = await response.json();
    const botReply = data.response;

    msgBox.innerHTML += `<div class="bubble bot"><strong>ZOE:</strong> ${botReply}</div>`;
    speak(botReply);
  }
</script>
{% endblock %}
